# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

---

## Данные и типы данных, используемые в приложении

Товар

```
export interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Информация о покупателе

```
export interface ICustomerData {
	payment: string;
	email: string;
	phone: string;
	address: string;
}
```

Успешный заказ

```
export interface IOrderSuccess {
	id: string;
	total: number;
}
```

Данные о виде оплаты и адрес формы доставки

```
export type TDeliveryForm = Pick<ICustomerData, 'payment' | 'address'>
```

Данные покупателя

```
export type TCustomerInfoForm = Pick<ICustomerData, 'email' | 'phone'>
```

Название и цена товара в форме корзины

```
export type TCartForm = Pick<IProduct, 'title' | 'price'>
```

Информация о товаре в форме товара

```
export type TProductCardForm = Pick<IProduct, 'title' | 'description' | 'image' | 'category' | 'price'>
```

Список запросов к апи

```
export type ApiListResponse<Type> = {
	total: number;
	items: Type[];
};
```

---

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструкторе передается базовый адрес сервера и опциональный объект
с заголовками запросов.

Методы:

- `get` - выполняет `GET` запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на
  эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняет `POST` запрос, но метод запроса может быть
  переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в
презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие,
- `emit` - инициализация события,
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ProductList

Класс отвечает за хранение и логику работу с данными товаров.\
Конструктор класса принимает инстанс брокера событий.\

В полях класса хранятся следующие данные:

- \_total: number - количество товаров,
- \_products: IProduct[] - массив товаров,
- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных.

Методы класса:

- getProduct(productId: string): IProduct | undefined - возвращает данные товара по его идентификатору,
- сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс Cart

Класс отвечает за хранение и логику работы с данными в корзине.\
Конструктор класса принимает инстанс брокера событий.\

В полях класса хранятся следующие данные:

- \_items: IProduct[] - массив товаров,
- \_cartPrice: number - цена коризны товаров,
- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных.

Методы класса:

- addProduct(product: IProduct): void - добавляет продукт в коризну. Генерирует событие "cart:added",
- productInCart(productId: string): boolean - определяет есть ли товар в корзине,
- removeProduct(productId: string): void - удаляет продукт из корзины по его идентификатору. Генерирует событие "cart:remove",
- updateCardPrice(): void - обновляет стоимость товаров в корзине,
- clear(): void - очищает корзину. Генерирует событие "cart:cleared",
- сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс Order

Класс отвечает за хранение данных и логику работы заказа товаров.\
Конструктор класса принимает инстанс брокера событий и инстанс Api.\

В полях класса хранятся следующие данные:

- \_total: number - сумма товаров,
- \_items: string - массив идентификаторов товаров,
  \_payment: string - способ оплаты заказа,
- \_email: string - почта покупателя,
- \_phone: string - телефон покупателя,
- \_address: string - адрес получателя,
- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- сеттеры и геттеры для сохранения и получения данных из полей класса.

Методы класса:

- order(): void - генерирует событие "order:send" и передает в нем информацию о заказе.

---

### Слой представления

Все классы представления отвечают за отображение внутри контейнера передаваемых в них данных.

### Класс Product

Реализует отображение карточки товара.\
Устанавливает информацию о карточке (название, описание, цену, изображеине, категорию).\
В конструктор передается инстанс брокера событий и DOM элемента шаблона.\

Поля класса:

- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- productData: IProduct - информация о товаре,
- element: HTMLElement - элемент карточки товара,
- titleElement: HTMLSpanElement | HTMLHeadingElement - элемент названия товара,
- imageElement: HTMLImageElement | null - элемент изображения товара,
- categoryElement: HTMLSpanElement | null - элемент категории товара,
- priceElement: HTMLSpanElement | null - элемент стоимости товара,
- descriptionElement: HTMLParagraphElement | null - элемент описания товара,
- cardButton: HTMLButtonElement | null - элемент кнопки удаления товара из корзины,
- \_productId: string; - идентификатор товара.

Методы класса:

- setData(productData: Partial<IProduct>): HTMLElement - станавливает данные товара. В метод можно передать как часть данных о товаре, так и полностью,
- render(): HTMLElement - возвращает карточку товара,
- remove(): void - удаляет карточку товара,
- updateCategotyColor(categoryElement: HTMLSpanElement, category: string): void - обновляет цвет категории товара,
- handleRemoveButtonClick(): void - обработчик события "click" кнопки удаления товара из корзины. Генерирует событие "cart:remove",
- handleOnProductClick(): void - обработчик события "click" по карточке товара. Генерирует событие "cardModal:open".

#### Класс Modal

Реализует модальное окно. Предоставляется методы `open` и `close` для управления отображением модального окна.\
Устанавливает слушателей событий на клик вне модального окна и кнопку закрытия окна.\
Конструктор класса принимает элемент содержимого модального окна.\

Поля класса:

- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- modal: HTMLDivElement - модальное окно.

Методы класса:

- setupEventListeners(): void - настраивает слушателей событий,
- handleModalClick(event: MouseEvent): void - обработчик события нажатия на модальное окно. Если нажатие было вне модального окна, то закрывает его,
- open(): void - открывает модальное окно,
- close(): void - закрывает модальное окно,
- render(): HTMLDivElement - возвращает модальное окно.

#### Класс CardModal

Расширяет класс Modal. Предназначен для реализации модального окна с карточкой товара.\
Предоставляет методы для отображения карточки товара.
Конструктор класса принимает информацию о товаре и инстанс брокера событий.

Поля класса:

- product: IProduct - информация о товаре,
- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- toCartButton: HTMLButtonElement - элемент кнопки "В корзину",

Методы класса:

- handleToCartButtonClick(productData: IProduct) - Обработчик события "click" кнопки добавления в корзину. Генерирует событие "cart:add".

#### Класс CartModal

Расширяет класс Modal. Предназначен для реализации модального окна с корзиной.\
Предоставляет методы для отображения товаров и оформления заказа.
Конструктор класса принимает инстанс брокера событий и шаблон модального окна.

Поля класса:

- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- basketList: HTMLUListElement - элемент списка товаров в корзине,
- basketPrice: HTMLUListElement - элемент суммы товаров в корзине,
- orderButton: HTMLButtonElement - кнопка оформления заказа,
- element: HTMLElement - элемент модального окна коризны.

Методы класса:

- open(): void - дополняет базовую функцию открытия окна. Обновляет состояние кнопки оформления заказа перед открытием корзины,
- addProduct(product: HTMLElement): void - добавляет товар в корзину,
- removeProduct(product: Product): void - удаляет товар из корзины,
- updateBasketPrice(productsPrice: number): void - обновляет цену корзины товаров,
- updateProductsCount(): void - обновляет нумерцаию товаров в корзине,
- handleOrderButtonClick(): void - обработчик события "click" кнопки оформления заказа. Закрывает модальное окно корзины и вызывает событие "deliveryModal:open",
- updateOrderButtonState(): void - обновляет состояние кнопки оформелния заказа.

#### Класс FormModal

Расширяет класс Modal. Предназначен для реализации модальных окон с формами.\
Предоставляет методы для изменения доступности кнопки сабмита в зависимости от правильности введенных данных.\
Конструктор класса принимает шаблон формы для отображения и инстанс брокера событий.

Поля класса:

- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- form: HTMLElement - элемент формы,
- submitButton: HTMLButtonElement - кнопка отправки формы,
- paymentButtons: NodeListOf<HTMLButtonElement> - псевдомассив кнопок выбора способа оплаты,
- inputs: NodeListOf<HTMLInputElement> - псевдомассив полей ввода,
- errorElement: HTMLSpanElement - элемент ошибки валидации,
- deliveryForm: boolean - флаг формы доставки и оплаты
- payment: string - способ оплаты.

Методы класса:

- handlePaymentButtonClick(event: MouseEvent): void - обработчик события 'click'. Изменяет предпочитаемый способ оплаты,
- isPaymentSelected(): boolean - проверяет наличие выбранного способа оплаты,
- isInputsFilled(): boolean - проверяет заполнение полей ввода,
- setErrorMessage(message: string): void - устанавливает сообщение об ошибки валидации,
- changeSubmitButtonState(state: boolean): void - изменяет состояние кнопки подветрждения формы,
- handleSubmitButtonClick(event: MouseEvent): void - jбработчик события "click" кнопки подтверждения формы. Отменяет стандартное поведение подтверждения формы. Генерирует нужное событие в зависимости от текущей формы.

#### Класс SuccessOrderModal

Расширяет класс Modal. Предназначен для отображения успешного заказа товаров.\
Конструктор класса принимает инстанс брокера событий, шаблон модального окна и информацию об успешном заказе.

Поля класса:

- events: IEvents - экземпляр класса `EventEmitter` для вызова событий при изменении данных,
- element: HTMLElement - элемент модального окна успешного заказа,
- orderData: IOrderSuccess - данные успешного заказа,
- modalOrderPriceElement: HTMLParagraphElement - элемент надписи успешного заказа,
- successButtonElement: HTMLButtonElement - элемент кнопки модального окна.

Методы класса:

- updateOrderPrice(total: number): void - обновляет цену заказа.

---

### Слой коммуникации

#### Взаимодейсвтие компонентов

Код, описывающий взаимодействие данных и представления, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие выполняется за счет событий, которые генерирует брокер событий, и обработчиков этих событий, описанных в `index.ts`.

**Список генерируемых событий:**

В файле `eventNames.ts` описано перечисление всех существующих событий:

```
CartAdd = 'cart:add', // Событие добавления товара в корзину
CartUpdateCount = 'cart:updateCount', // Событие обновление количества товаров в корзине
CartRemoved = 'cart:removed', // Событие удаленного товара из корзины
CartUpdatePrice = 'cart:updatePrice', // Событие обновления цены товара в корзине
CartCleared = 'cart:cleared', // Событие очистки корзины
CartRemove = 'cart:remove', // Событие удаления товара из корзины
DeliveryModalOpen = 'deliveryModal:open', // Событие открытия модального окна с выбором способаоплаты и адреса доставки
DeliveryModalSubmit = 'deliveryModal:submit', // Событие подтверждения формы оплаты и адресадоставки
ContactsModalOpen = 'contactsModal:open', // Событие открытия модального окна с вводомконтактных данных
ContactsModalSubmit = 'contacntsModal:submit', // Событие подтверждения формы контактных данных
OrderSend = 'order:send', // Событие отправки заказа
CardModalOpen = 'cardModal:open', // Событие открытия модального окна с карточкой товара
ProductListChanged = 'productList:changed', // Событие изменения списка товаров
```
